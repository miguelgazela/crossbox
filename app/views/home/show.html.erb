<%= render "./navbar" %>

<section>

  <h2 class="text-center">PRÓXIMAS AULAS</h2>

  <ul class="list-group class-hour-list">

  <% @results.first(4).each_with_index do |result, index| %>

    <li class="list-group-item class-hour-list-item class-hour-minimal">

      <div class="class-hour-column-info">

        <p class="class-hour-title <% if result[:in_workout] %>class-hour-title-active<% end %>">Treino das <%= result[:workout].date.strftime("%H:%M") %> - <%= result[:workout].date.strftime("%d/%m") %></p>

        <div class="class-hour-elements">
          <span><%= result[:free_spots] %> vagas</span>
          <% result[:thumbnails].each_with_index do |thumbnail, index| %>
            <img src="<%= thumbnail %>" alt="" class="img-circle"/>
          <% end %>
          <% if result[:excess_users] > 0 %>
            <span>+<%= result[:excess_users]%></span>
          <% end %>
        </div>

        <div class="class-hour-controls">
          <a class="btn btn-sm btn-default" href="/workouts/<%= result[:workout].id %>" role="button"><span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span> Ver</a>

          <% if not result[:workout].date < Time.zone.now %>

            <% if !result[:in_workout] %>

              <% if !result[:is_busy] %>

                <button type="button" class="btn btn-sm btn-default" onclick="enterWorkout(<%= result[:workout].id %>)"><span class="glyphicon glyphicon-plus-sign" aria-hidden="true"></span> Inscrever</button>
              <% end %>

            <% else %>
            <a class="btn btn-sm btn-default btn-forfeit" href="/workouts/<%= result[:workout].id %>/state?a=leave&rh=1" role="button"><span class="glyphicon glyphicon-minus-sign" aria-hidden="true"></span> Desistir</a>
            <% end %>

          <% end %>

        </div>

      </div>

      <div class="class-hour-graphical-availability <%= result[:availability_class] %>" data-completion="<%= result[:percentage] %>">
        <div><%= result[:free_spots] %></div>
      </div>

    </li>

  <% end %>

  </ul>

</section>

<section>
  <h2 class="text-center">ACTIVIDADE RECENTE</h2>

  <ul class="list-group list-activity">

    <% @events.each_with_index do |event, index| %>

      <li class="list-group-item activity-event">

        <div class="media">
          <div class="media-left activity-event-user-thumbnail">
            <a href="#">
              <% if event.title == 'WORKOUT' %>
              <img class="media-object" src="<%= event.training.user.image %>" alt="...">
              <% else %>
              <img class="media-object" src="<%= event.pr_entry.user.image %>" alt="...">
              <% end %>

            </a>
          </div>
          <div class="media-body">

            <% if event.title == 'WORKOUT' %>
              <p class="activity-event-info-primary"><span class="username"><%= event.training.user.name %> </span> acabou de se inscrever na aula das <%= event.workout.date.strftime('%H:%M') %> de <% if event.workout.date.strftime('%w') == '0' %> domingo<% elsif event.workout.date.strftime('%w') == '1' %> segunda-feira<% elsif event.workout.date.strftime('%w') == '2' %> terça-feira<% elsif event.workout.date.strftime('%w') == '3' %> quarta-feira<% elsif event.workout.date.strftime('%w') == '4' %> quinta-feira<% elsif event.workout.date.strftime('%w') == '5' %> sexta-feira<% elsif event.workout.date.strftime('%w') == '6' %> sábado<% end %>.</p>
              <p class="activity-event-info-secondary"><%= distance_of_time_in_words(Time.now, event.created_at) %> ago</p>
            <% else %>

              <% if event.pr_entry.exercise_id == 1 %>
              <p class="activity-event-info-primary"><span class="username"><%= event.pr_entry.user.name %> </span> hoje fez Front Squat com uns incríveis <%= event.pr_entry.value %>kg - <%= event.pr_entry.repetitions %>x <%= event.pr_entry.load_percentage %>%</p>
              <% elsif event.pr_entry.exercise_id == 2 %>
              <p class="activity-event-info-primary"><span class="username"><%= event.pr_entry.user.name %> </span> agachou e fez Back Squat com <%= event.pr_entry.value %>kg às costas - <%= event.pr_entry.repetitions %>x <%= event.pr_entry.load_percentage %>%</p>
              <% elsif event.pr_entry.exercise_id == 3 %>
              <p class="activity-event-info-primary"><span class="username"><%= event.pr_entry.user.name %> </span> alcançou um Hang Clean limpinho com <%= event.pr_entry.value %>kg - <%= event.pr_entry.repetitions %>x <%= event.pr_entry.load_percentage %>%</p>
              <% end %>
              <p class="activity-event-info-secondary"><%= distance_of_time_in_words(Time.now, event.created_at) %> ago</p>

            <% end %>


          </div>
        </div>

      </li>

    <% end %>

  </ul>

</section>

<%= render "./navfooter" %>
